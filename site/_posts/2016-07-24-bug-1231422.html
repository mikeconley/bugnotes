---
layout: post
title:  "Bug 1231422 - Intermittent browser_async_window_flushing.js | We should not have added the window to the closed windows array - Got 1, expected 0"
date:   2016-07-24
tags:
---

<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1231422">
 Bug 1231422 - Intermittent browser_async_window_flushing.js | We should not have added the window to the closed windows array - Got 1, expected 0
</a>
<div>
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2befbfc27b7f">
 </a>
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2befbfc27b7f">
  https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2befbfc27b7f
 </a>
</div>
<div>
 <br/>
</div>
<div>
 <br/>
</div>
<div>
 07:09:52Â  Â  Â INFOÂ -Â  mconley:Â THEÂ INTERESTINGÂ STUFFÂ ISÂ STARTING
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOCSHELLÂ 0x7ff05b71d000Â ==Â 66Â [pidÂ =Â 2056]Â [idÂ =Â 625]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 155Â (0x7ff056e73800)Â [pidÂ =Â 2056]Â [serialÂ =Â 1896]Â [outerÂ =Â (nil)]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 156Â (0x7ff056e77c00)Â [pidÂ =Â 2056]Â [serialÂ =Â 1897]Â [outerÂ =Â 0x7ff056e73800]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOCSHELLÂ 0x7ff05b73b000Â ==Â 67Â [pidÂ =Â 2056]Â [idÂ =Â 626]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 157Â (0x7ff0576cc800)Â [pidÂ =Â 2056]Â [serialÂ =Â 1898]Â [outerÂ =Â (nil)]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOCSHELLÂ 0x7ff05b73b800Â ==Â 68Â [pidÂ =Â 2056]Â [idÂ =Â 627]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 158Â (0x7ff0576cd000)Â [pidÂ =Â 2056]Â [serialÂ =Â 1899]Â [outerÂ =Â (nil)]
 <br/>
 07:09:52Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 159Â (0x7ff0576cf400)Â [pidÂ =Â 2056]Â [serialÂ =Â 1900]Â [outerÂ =Â 0x7ff0576cd000]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOCSHELLÂ 0x7ff05bb63800Â ==Â 69Â [pidÂ =Â 2056]Â [idÂ =Â 628]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 160Â (0x7ff0576cc400)Â [pidÂ =Â 2056]Â [serialÂ =Â 1901]Â [outerÂ =Â (nil)]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 161Â (0x7ff057edbc00)Â [pidÂ =Â 2056]Â [serialÂ =Â 1902]Â [outerÂ =Â 0x7ff0576cc400]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 162Â (0x7ff0580afc00)Â [pidÂ =Â 2056]Â [serialÂ =Â 1903]Â [outerÂ =Â 0x7ff0576cc800]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 163Â (0x7ff058154800)Â [pidÂ =Â 2056]Â [serialÂ =Â 1904]Â [outerÂ =Â 0x7ff0576cd000]
 <br/>
 07:09:53Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 164Â (0x7ff058159c00)Â [pidÂ =Â 2056]Â [serialÂ =Â 1905]Â [outerÂ =Â 0x7ff0576cc400]
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  ++DOMWINDOWÂ ==Â 165Â (0x7ff058bcb000)Â [pidÂ =Â 2056]Â [serialÂ =Â 1906]Â [outerÂ =Â 0x7ff0576cc400]
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â CLOSINGÂ THEÂ WINDOW
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â AÂ windowÂ closed
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â DeterminingÂ ifÂ {
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "tabs":Â [
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â {
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "entries":Â [
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "url":Â "
 <a href="http://example.com/">
  http://example.com/
 </a>
 ",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "charset":Â "UTF-8",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "ID":Â 734,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "docshellID":Â 628,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "docIdentifier":Â 734,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "persist":Â true
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ],
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "lastAccessed":Â 1453475394888,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "hidden":Â false,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "attributes":Â {},
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "userContextId":Â 0,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "index":Â 1,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "image":Â null
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â }
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â ],
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "selected":Â 1,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "_closedTabs":Â [],
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "width":Â 1280,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "height":Â 1040,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "screenX":Â 66,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "screenY":Â 52,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "sizemode":Â "normal",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "title":Â "
 <a href="http://example.com/">
  http://example.com/
 </a>
 ",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "_shouldRestore":Â true,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "closedAt":Â 1453475394901
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  }Â isÂ worthÂ saving.
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â TestingÂ ifÂ weÂ shouldÂ saveÂ tabÂ state:Â {
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "entries":Â [
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â {
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "url":Â "
 <a href="http://example.com/">
  http://example.com/
 </a>
 ",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "charset":Â "UTF-8",
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "ID":Â 734,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "docshellID":Â 628,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "docIdentifier":Â 734,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "persist":Â true
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â  Â  Â  Â  Â }
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â ],
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "lastAccessed":Â 1453475394888,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "hidden":Â false,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "attributes":Â {},
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "userContextId":Â 0,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "index":Â 1,
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  Â  Â "image":Â null
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  }
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â hasSaveableTabs:Â trueÂ -Â isLastWindow:Â false
 <br/>
 07:09:54Â  Â  Â INFOÂ -Â  mconley:Â InsertingÂ tabData
 <br/>
 07:09:55Â  Â  Â INFOÂ -Â  mconley:Â DOMWindowClosedÂ hasÂ firedÂ -Â nowÂ checkingÂ theÂ currentÂ closedÂ windowÂ count
 <br/>
 07:09:55Â  Â  Â INFOÂ -Â  TheÂ countÂ is:Â 1
 <br/>
 07:09:55Â  Â  Â INFOÂ -Â  TEST-INFOÂ |Â startedÂ processÂ screentopng
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  TEST-INFOÂ |Â screentopng:Â exitÂ 0
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  195Â INFOÂ checkingÂ windowÂ state
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  196Â INFOÂ ConsoleÂ message:Â [JavaScriptÂ Error:Â "TelemetryStopwatch:Â requestingÂ elapsedÂ timeÂ forÂ nonexistingÂ stopwatch.Â Histogram:Â "FX_PAGE_LOAD_MS",Â key:Â "null""Â {file:Â "resource://gre/modules/TelemetryStopwatch.jsm"Â line:Â 297}]
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  197Â INFOÂ EnteringÂ testÂ test_add_interesting_window
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  198Â INFOÂ TEST-UNEXPECTED-FAILÂ |Â browser/components/sessionstore/test/browser_async_window_flushing.jsÂ |Â WeÂ shouldÂ notÂ haveÂ addedÂ theÂ windowÂ toÂ theÂ closedÂ windowsÂ arrayÂ -Â GotÂ 1,Â expectedÂ 0
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  StackÂ trace:
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  Â  Â  chrome://mochikit/content/browser-test.js:test_is:979
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  Â  Â  chrome://mochitests/content/browser/browser/components/sessionstore/test/browser_async_window_flushing.js:test_add_interesting_window:74
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  Â  Â  Tester_execTest@chrome://mochikit/content/browser-test.js:803:9
 <br/>
 07:09:56Â  Â  Â INFOÂ -Â  Â  Â  Tester.prototype.nextTest&lt;/&lt;@chrome://mochikit/content/browser-test.js:723:7
</div>
<div>
 07:09:56Â  Â  Â INFOÂ -Â  Â  Â  SimpleTest.waitForFocus/waitForFocusInner/focusedOrLoaded/&lt;@chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:735:59
</div>
<div>
 <br/>
</div>
<div>
 <br/>
</div>
<div>
 Oh noooooooooooo. I know whatâ€™s happening.
</div>
<div>
 <br/>
</div>
<div>
 My observer for theÂ browser.sessionstore.debug.no_auto_updates pref isnâ€™t working because the observer function is comparing the _topic_ againstÂ browser.sessionstore.debug.no_auto_updates and not the data! WOE IS ME.
</div>
<div>
 <br/>
</div>
<div>
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=36b3f28cd14b">
 </a>
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=36b3f28cd14b">
  https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=36b3f28cd14b
 </a>
</div>
<div>
 <br/>
</div>
<div>
 Huh. And this landed, and the bug remains. WTactualF?
</div>
<div>
 <br/>
</div>
<div>
 MOAR LOGGING:
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=e3b88268ddf8">
 </a>
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=e3b88268ddf8">
  https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=e3b88268ddf8
 </a>
</div>
<div>
 <br/>
</div>
<div>
 Aw cripes, this is another embarrassing thing - when timeoutDisabled is set to true, active timers arenâ€™t canceled.
 <span style="-evernote-sentoj-emoticon:true">
  ðŸ˜”
 </span>
</div>
<div>
 <br/>
</div>
<div>
 Try build:
 <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=03c1b1945fdb">
  https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=03c1b1945fdb
 </a>
</div>
<div>
 <br/>
</div>
<div>
 Couldâ€¦ could this be somehow related to bug 1195295?
</div>
<div>
 <br/>
</div>
<div>
 I donâ€™t think so. Still, patch posted.
</div>
